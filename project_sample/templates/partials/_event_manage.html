
{% load crispy_forms_tags %}
<div class="modal fade" id="eventManageModal" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="evenManageModalLabel">Event Dialog</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
          <span>&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="eventForm" method="POST">
          {% csrf_token %}
          {{ eventForm|crispy }}
          <input type="submit" value="Add" class="btn btn-block btn-primary" name="sendBtn">

        </form>
        <script type="text/javascript">

          function getUrl(view, id) {
            var base_url = '{{ request.scheme }}://{{ request.get_host }}'
            console.log("url " + base_url)
            return  '{{ request.scheme }}://{{ request.get_host }}/' + view + id + '/';
          };
          $(document).on('submit', '#eventForm', function(e){
            e.preventDefault();
            var event = {
              "title": $('#id_title').val(),
              "start": $('#id_start').val(),
              "end": $('#id_end').val(),
              "rule": $('#id_rule option:selected').val(),
              "end_recurring_period": $('#id_end_recurring_period').val(),
              "color": $('#id_color_event').val(),
              "calendar":  getUrl('apis/calendars/', $('#id_calendar option:selected').val()),
              "event_type": getUrl('apis/event_types/', $('#id_event_type option:selected').val())
            };
            console.log("Event color " + event.color_event)
            $.ajaxSetup({
              headers: { "X-CSRFToken": '{{ csrf_token }}' }
            });
            $.ajax({
              type: 'POST',
              dataType: 'json',
              url: '/apis/events/',
              data: event,
              success:function(result) {
                alert("Event added to calendar.");
                $('#calendar').fullCalendar('renderEvent', event);
                //$(':input', '#mailerForm').not(':button, :submit, :hidden').val('')
                $('#eventManageModal').modal('hide');

              },
              error:function(xhr) {
                alert("error: "  + xhr.status + ' ' + xhr.statusText + ' ' + xhr.responseText )
              }

            });
          });




        </script>
      </div>
    </div>
  </div>
</div>
